<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåà Glow Up World - Codage 11</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --fraise: #ffb7c5; --menthe: #c1f0e1; --lavande: #dcd3ff;
            --citron: #fff4bd; --sucre: #ffffff; --texte: #8e7cc3;
        }

        body {
            margin: 0; font-family: 'Fredoka', sans-serif;
            background: linear-gradient(180deg, var(--fraise), var(--lavande));
            min-height: 100vh; display: flex; justify-content: center; color: var(--texte); overflow: hidden;
        }

        .app-container { width: 100%; max-width: 420px; height: 100vh; display: flex; flex-direction: column; position: relative; }
        .screen { display: none; flex-direction: column; align-items: center; padding: 20px; height: calc(100vh - 80px); overflow-y: auto; box-sizing: border-box; }
        .active { display: flex !important; animation: popIn 0.4s ease-out; }

        @keyframes popIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        /* --- BARRE DE NAVIGATION (FIXE EN BAS) --- */
        .nav-bar {
            position: absolute; bottom: 0; width: 100%; height: 70px;
            background: var(--sucre); display: flex; justify-content: space-around; align-items: center;
            border-radius: 30px 30px 0 0; box-shadow: 0 -5px 15px rgba(0,0,0,0.05); z-index: 100;
        }
        .nav-item { cursor: pointer; font-size: 1.5rem; transition: 0.3s; filter: grayscale(1); }
        .nav-item.active { filter: grayscale(0); transform: translateY(-5px) scale(1.2); }

        /* --- STREAK & HEADER --- */
        .header-status {
            background: var(--sucre); width: 100%; padding: 15px; border-radius: 25px;
            display: flex; justify-content: space-between; align-items: center; box-sizing: border-box;
            border: 3px solid var(--fraise); margin-bottom: 15px;
        }
        .streak-fire { color: #FF4500; font-weight: 700; display: flex; align-items: center; gap: 5px; }

        /* --- CARDS & ITEMS --- */
        .magic-card {
            background: var(--sucre); padding: 20px; border-radius: 35px; width: 100%;
            box-shadow: 0 10px 0 var(--lavande); text-align: center; margin-bottom: 20px; box-sizing: border-box;
        }
        .grid-games { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; }
        .game-box {
            background: var(--citron); padding: 20px; border-radius: 30px; cursor: pointer;
            transition: 0.2s; border: 3px solid white;
        }
        .game-box:hover { transform: translateY(-5px); }

        /* --- CHAMBRE VIRTUELLE --- */
        .room-view {
            width: 100%; height: 250px; background: var(--menthe); border-radius: 30px;
            position: relative; border: 5px solid white; overflow: hidden;
            display: flex; justify-content: center; align-items: flex-end; padding-bottom: 20px;
        }
        .pet { font-size: 4rem; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

        /* --- BOUTONS --- */
        .btn-action {
            background: var(--fraise); color: white; border: none; padding: 15px 25px;
            border-radius: 50px; font-family: 'Fredoka'; font-weight: 700; cursor: pointer;
            box-shadow: 0 5px 0 #e5a4b1; margin-top: 10px;
        }
    </style>
</head>
<body>

    <div class="app-container">
        
        <div id="auth-screen" class="screen active">
            <div class="magic-card" style="margin-top: 50px;">
                <h1 style="color: var(--fraise);">Glow Up World ‚ú®</h1>
                <input type="text" id="username" style="width:100%; padding:15px; border-radius:20px; border:2px solid var(--lavande); margin:10px 0;" placeholder="Ton pseudo adorable">
                <input type="password" id="pass" style="width:100%; padding:15px; border-radius:20px; border:2px solid var(--lavande); margin:10px 0;" placeholder="Mot de passe">
                <button onclick="validerAuth()" class="btn-action">Ouvrir le portail ü™Ñ</button>
            </div>
        </div>

        <div id="wish-screen" class="screen">
            <div class="header-status">
                <div class="streak-fire">üî• 7 Jours</div>
                <div style="background:var(--menthe); padding:5px 15px; border-radius:20px;">üíé <span id="diamond-count">0</span></div>
            </div>
            <div class="magic-card">
                <p>PIOCHE TON V≈íU üç¨</p>
                <div style="font-size:4rem; margin:20px 0;">‚ú®</div>
                <h2 id="wish-title">Chargement...</h2>
                <button onclick="ouvrirVoeu()" class="btn-action">R√©aliser üå∏</button>
            </div>
        </div>

        <div id="games-screen" class="screen">
            <h2 style="color:white; text-shadow:2px 2px var(--fraise);">ARCADE MAGIQUE üéÆ</h2>
            <div class="grid-games">
                <div class="game-box" onclick="jouer('Memory')">üß†<br>Memory</div>
                <div class="game-box" onclick="jouer('Snake')">üêç<br>Snake Math</div>
                <div class="game-box" onclick="jouer('Words')">üìù<br>Mots Cach√©s</div>
                <div class="game-box" onclick="jouer('Rhythm')">üéµ<br>Rythme</div>
            </div>
            <div class="magic-card" style="margin-top:20px;">
                <p>üéÅ Coffre Myst√®re Quotidien</p>
                <button onclick="ouvrirCoffre()" class="btn-action">Ouvrir ! üì¶</button>
            </div>
        </div>

        <div id="room-screen" class="screen">
            <h2 style="color:white; text-shadow:2px 2px var(--fraise);">MA CHAMBRE ‚ú®</h2>
            <div class="room-view" id="room">
                <div class="pet">üê±</div> </div>
            <div class="grid-games" style="margin-top:20px;">
                <div class="game-box" style="background:var(--sucre)" onclick="acheter('Graines')">üå±<br>Jardin</div>
                <div class="game-box" style="background:var(--sucre)" onclick="acheter('Poisson')">üê†<br>Aquarium</div>
            </div>
            <button class="btn-action" style="width:100%">Boutique de meubles üõãÔ∏è</button>
        </div>

        <div class="nav-bar" id="nav-bar" style="display:none;">
            <div class="nav-item active" onclick="show('wish-screen', this)">‚ú®</div>
            <div class="nav-item" onclick="show('games-screen', this)">üéÆ</div>
            <div class="nav-item" onclick="show('room-screen', this)">üè†</div>
        </div>

    </div>

    <div id="game-view" style="position:fixed; top:0; left:0; width:100%; height:100%; background:var(--lavande); z-index:999; display:none; flex-direction:column; align-items:center; justify-content:center; padding:20px; box-sizing:border-box;">
        <div class="magic-card">
            <h2 id="ex-q">...</h2>
            <input type="text" id="ex-ans" style="width:100%; padding:15px; border-radius:20px; border:2px solid var(--menthe); text-align:center;">
            <button onclick="verifierReponse()" class="btn-action">Magie ! ‚ú®</button>
            <p onclick="document.getElementById('game-view').style.display='none'" style="margin-top:15px; cursor:pointer; color:#ccc">Retour</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const S_URL = 'https://lcbwehiwjowgthazrydy.supabase.co';
        const S_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxjYndlaGl3am93Z3RoYXpyeWR5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkzNTg4NjIsImV4cCI6MjA4NDkzNDg2Mn0.2nP42Uh262Jt-1stolzSVM8_EEzrAdCutKgd7B2MurY';
        const client = window.supabase.createClient(S_URL, S_KEY, { auth: { persistSession: false } });

        let session = null, diamonds = 0;

        // --- AUTH (STRICTEMENT GARDEE) ---
        async function validerAuth() {
            const user = document.getElementById('username').value.trim();
            const pass = document.getElementById('pass').value;
            const internalEmail = user.toLowerCase() + "@academy.user";
            const { data, error } = await client.auth.signInWithPassword({ email: internalEmail, password: pass });
            if(error) { alert("Acc√®s refus√© !"); return; }
            session = data.user;
            recupererProfil();
        }

        async function recupererProfil() {
            const { data } = await client.from('profiles').select('*').eq('id', session.id).single();
            diamonds = data.diamonds;
            document.getElementById('diamond-count').innerText = diamonds;
            document.getElementById('auth-screen').classList.remove('active');
            document.getElementById('wish-screen').classList.add('active');
            document.getElementById('nav-bar').style.display = 'flex';
            document.getElementById('wish-title').innerText = "V≈ìu Magique #1";
        }

        // --- NAVIGATION ---
        function show(screenId, el) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            el.classList.add('active');
        }

        // --- FONCTIONS EXTRA ---
        function ouvrirCoffre() {
            const gain = Math.floor(Math.random() * 50) + 10;
            alert(`üì¶ F√©licitations ! Tu as trouv√© ${gain} diamants !`);
            updateDiamonds(gain);
        }

        function jouer(nom) { alert("Le jeu " + nom + " va commencer ! ‚ú® (En d√©veloppement)"); }

        function ouvrirVoeu() {
            document.getElementById('game-view').style.display = 'flex';
            document.getElementById('ex-q').innerText = "Combien font 12 + 8 ?";
        }

        async function verifierReponse() {
            if(document.getElementById('ex-ans').value === "20") {
                confetti({ particleCount: 150, spread: 70, colors: ['#ffb7c5', '#c1f0e1'] });
                updateDiamonds(10);
                document.getElementById('game-view').style.display = 'none';
            } else { alert("Boing ! üç™ Oups, r√©essaie !"); }
        }

        async function updateDiamonds(val) {
            diamonds += val;
            document.getElementById('diamond-count').innerText = diamonds;
            await client.from('profiles').update({ diamonds: diamonds }).eq('id', session.id);
        }
    </script>
</body>
</html>
