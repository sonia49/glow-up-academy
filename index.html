<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üç≠ Candy Academy ‚ú®</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* DESIGN CLAIR ET NET COMME DEMAND√â */
        body { font-family: sans-serif; background: linear-gradient(to bottom, #FFE5F1, #A5E7FF); min-height: 100vh; margin: 0; display: flex; justify-content: center; align-items: center; }
        .glass { background: rgba(255,255,255,0.8); backdrop-filter: blur(10px); padding: 30px; border-radius: 40px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 350px; text-align: center; }
        input { width: 90%; padding: 15px; margin: 10px 0; border-radius: 20px; border: 2px solid #FFB3D9; outline: none; }
        button { width: 100%; padding: 15px; margin: 10px 0; border-radius: 20px; border: none; font-weight: bold; cursor: pointer; }
        .btn-go { background: #FF6B9D; color: white; }
        .btn-guest { background: #eee; color: #666; font-size: 0.8rem; }
        .hidden { display: none; }
        .stat { display: inline-block; background: white; padding: 10px; border-radius: 15px; margin: 5px; font-weight: bold; color: #FF6B9D; }
    </style>
</head>
<body>

    <div class="glass" id="auth-box">
        <h1 style="color:#FF6B9D;">üç≠ Candy Academy</h1>
        <p id="status" style="color:#999;">Connecte-toi vite !</p>
        <input type="text" id="user" placeholder="Pseudo">
        <input type="password" id="pass" placeholder="Mot de passe">
        <button class="btn-go" onclick="connexion()">SE CONNECTER üç¨</button>
        <button class="btn-go" style="background:#A5E7FF;" onclick="inscription()">CR√âER COMPTE ‚ú®</button>
        <button class="btn-guest" onclick="invite()">Mode Invit√© (Sans sauvegarde)</button>
    </div>

    <div class="glass hidden" id="game-box">
        <h2 id="hello">Salut !</h2>
        <div class="stat">üíé <span id="dia">100</span></div>
        <div class="stat">‚≠ê Niv. 1</div>
        <hr border="0" height="1px" background="#eee">
        <div id="ex-area" style="padding:20px; background:#FFB3D9; border-radius:20px; color:white; font-size:1.5rem; margin:10px 0; cursor:pointer;" onclick="faireExo()">
            CLIQUE ICI POUR L'EXO
        </div>
        <p style="font-size:0.8rem; color:#999;">Gagne 10 diamants par r√©ponse !</p>
    </div>

    <script>
        const S_URL = 'https://lcbwehiwjowgthazrydy.supabase.co';
        const S_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxjYndlaGl3am93Z3RoYXpyeWR5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkzNTg4NjIsImV4cCI6MjA4NDkzNDg2Mn0.2nP42Uh262Jt-1stolzSVM8_EEzrAdCutKgd7B2MurY';
        const supabase = window.supabase.createClient(S_URL, S_KEY);

        let monProfil = { diamonds: 100, email: "Invit√©" };

        async function inscription() {
            const u = document.getElementById('user').value;
            const p = document.getElementById('pass').value;
            document.getElementById('status').innerText = "Cr√©ation...";
            
            const { data, error } = await supabase.auth.signUp({ email: u+"@c.app", password: p });
            if(error) { alert("Erreur: " + error.message); return; }
            
            await supabase.from('profiles').insert([{ id: data.user.id, email: u, diamonds: 100 }]);
            alert("Compte cr√©√© ! Maintenant clique sur SE CONNECTER");
            document.getElementById('status').innerText = "Pr√™t !";
        }

        async function connexion() {
            const u = document.getElementById('user').value;
            const p = document.getElementById('pass').value;
            document.getElementById('status').innerText = "Magie...";

            const { data, error } = await supabase.auth.signInWithPassword({ email: u+"@c.app", password: p });
            if(error) { alert("Rat√© ! V√©rifie ton MDP"); return; }

            const { data: prof } = await supabase.from('profiles').select('*').eq('id', data.user.id).single();
            monProfil = prof;
            ouvrirJeu();
        }

        function invite() {
            ouvrirJeu();
        }

        function ouvrirJeu() {
            document.getElementById('auth-box').classList.add('hidden');
            document.getElementById('game-box').classList.remove('hidden');
            document.getElementById('hello').innerText = "Salut " + monProfil.email + " !";
            document.getElementById('dia').innerText = monProfil.diamonds;
        }

        function faireExo() {
            let r = prompt("Combien font 10 + 10 ?");
            if(r === "20") {
                alert("BRAVO ! +10 üíé");
                monProfil.diamonds += 10;
                document.getElementById('dia').innerText = monProfil.diamonds;
                if(monProfil.id) {
                    supabase.from('profiles').update({ diamonds: monProfil.diamonds }).eq('id', monProfil.id).then();
                }
            } else {
                alert("Oups, r√©essaie !");
            }
        }
    </script>
</body>
</html>
