<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üç≠ Candy Dream Academy - Codage 14</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Bubblegum+Sans&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --candy-pink: #FFB3D9; --candy-blue: #A5E7FF;
            --candy-purple: #E0BBE4; --candy-yellow: #FFF4A3;
            --white: #FFFFFF; --texte: #8B7AB8;
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background: linear-gradient(135deg, #FFE5F1, #E0BBE4, #A5E7FF);
            background-size: 400% 400%;
            animation: flow 15s ease infinite;
            min-height: 100vh; display: flex; justify-content: center; overflow: hidden;
        }

        @keyframes flow { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }

        .container { width: 100%; max-width: 450px; position: relative; z-index: 10; padding: 15px; }
        .screen { display: none; animation: popIn 0.5s ease; flex-direction: column; align-items: center; }
        .active { display: flex !important; }

        @keyframes popIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        /* --- AUTH CARD --- */
        .auth-card {
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px);
            padding: 40px 25px; border-radius: 50px; text-align: center;
            margin-top: 50px; border: 4px solid white; box-shadow: 0 15px 40px rgba(255, 179, 217, 0.4);
        }

        .logo { font-family: 'Bubblegum Sans', cursive; font-size: 2.5rem; color: #FF6B9D; margin-bottom: 20px; }

        /* --- DASHBOARD --- */
        .header {
            background: white; width: 100%; padding: 20px; border-radius: 35px;
            margin-bottom: 15px; border: 3px solid white; box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }
        .user-info { display: flex; align-items: center; gap: 15px; }
        .avatar-circle {
            width: 70px; height: 70px; border-radius: 50%; background: var(--candy-yellow);
            display: flex; align-items: center; justify-content: center; font-size: 2.5rem;
            border: 4px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); cursor: pointer;
        }
        .stats-bar { display: flex; justify-content: space-around; margin-top: 15px; width: 100%; }
        .stat { font-weight: 700; font-size: 0.9rem; color: #FF6B9D; }

        /* --- CATEGORIES & CARDS --- */
        .categories { display: flex; gap: 8px; margin-bottom: 20px; }
        .cat-btn {
            padding: 12px 18px; border-radius: 20px; border: none; background: white;
            font-family: 'Fredoka'; font-weight: 700; cursor: pointer; transition: 0.3s;
        }
        .cat-btn.active { background: #FF6B9D; color: white; transform: scale(1.1); }

        .wish-card {
            background: white; width: 100%; border-radius: 40px; padding: 40px;
            text-align: center; border: 4px solid white; cursor: pointer;
            box-shadow: 0 20px 50px rgba(255, 179, 217, 0.3); transition: 0.3s;
        }
        .wish-card:hover { transform: translateY(-5px); }
        .wish-icon { font-size: 4.5rem; margin-bottom: 15px; animation: float 3s infinite ease-in-out; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

        /* --- MODAL AVATAR & EXERCICE --- */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(224, 187, 228, 0.95); z-index: 1000;
            display: none; align-items: center; justify-content: center; padding: 20px;
        }
        .modal-content {
            background: white; width: 100%; max-width: 380px; padding: 35px;
            border-radius: 45px; text-align: center; box-shadow: 0 30px 60px rgba(0,0,0,0.1);
        }

        input {
            width: 100%; padding: 18px; border-radius: 25px; border: 3px solid var(--candy-blue);
            margin: 15px 0; text-align: center; font-family: 'Fredoka'; font-size: 1.1rem;
        }
        .btn-candy {
            width: 100%; padding: 18px; border: none; border-radius: 30px;
            background: linear-gradient(135deg, #FF6B9D, #FFB347); color: white;
            font-weight: 700; font-size: 1.1rem; cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="container">
        <div id="auth-screen" class="screen active">
            <div class="auth-card">
                <h1 class="logo">üç≠ Candy Academy</h1>
                <p style="color: #C8A2E8; margin-bottom: 25px;">Apprendre est un d√©lice ! ‚ú®</p>
                <input type="text" id="username" placeholder="Pseudo Magique">
                <input type="password" id="password" placeholder="Mot de passe">
                <button class="btn-candy" onclick="handleAuth()">Entrer au Royaume üè∞</button>
            </div>
        </div>

        <div id="dashboard" class="screen">
            <div class="header">
                <div class="user-info">
                    <div class="avatar-circle" id="my-avatar" onclick="openAvatarMenu()">üëß</div>
                    <div>
                        <div class="username" id="display-name" style="font-weight:700; color:#FF6B9D;">Joueur</div>
                        <div class="stat">üî• Streak : <span id="streak-val">0</span> jours</div>
                    </div>
                </div>
                <div class="stats-bar">
                    <div class="stat">üíé <span id="diamond-val">0</span></div>
                    <div class="stat">‚≠ê Niv. <span id="level-val">1</span></div>
                </div>
            </div>

            <div class="categories">
                <button class="cat-btn active" onclick="setCat('math', this)">üç© Maths</button>
                <button class="cat-btn" onclick="setCat('french', this)">üç¨ Fran√ßais</button>
                <button class="cat-btn" onclick="setCat('english', this)">üç¶ English</button>
            </div>

            <div class="wish-card" onclick="openExercise()">
                <div class="wish-icon" id="wish-emoji">üç©</div>
                <h2 id="wish-title" style="color:#8B7AB8;">V≈ìu Magique #1</h2>
                <div style="margin-top:15px; color:#4ECDC4; font-weight:700;">Gagne 10 Diamants üíé</div>
            </div>

            <div style="display:flex; gap:20px; margin-top:20px;">
                <button class="cat-btn" onclick="nav(-1)">üëà</button>
                <button class="cat-btn" onclick="nav(1)">üëâ</button>
            </div>
        </div>
    </div>

    <div id="ex-modal" class="modal">
        <div class="modal-content">
            <h2 id="ex-title" style="color:#FF6B9D;">Exercice ‚ú®</h2>
            <p id="ex-q" style="font-size:1.6rem; margin:25px 0; color:#8B7AB8; font-weight:700;"></p>
            <input type="text" id="ex-ans" placeholder="Ta r√©ponse...">
            <button class="btn-candy" onclick="checkAns()">Lancer le sort ! ü™Ñ</button>
            <p onclick="closeModal()" style="margin-top:15px; cursor:pointer; color:#ccc;">Plus tard</p>
        </div>
    </div>

    <div id="avatar-modal" class="modal">
        <div class="modal-content">
            <h2>Ton Look Magique üéÄ</h2>
            <div style="display:flex; justify-content:center; gap:15px; margin:20px 0;">
                <div class="avatar-circle" onclick="changeAvatar('üëß')">üëß</div>
                <div class="avatar-circle" onclick="changeAvatar('üßö‚Äç‚ôÄÔ∏è')">üßö‚Äç‚ôÄÔ∏è</div>
                <div class="avatar-circle" onclick="changeAvatar('üëë')">üëë</div>
                <div class="avatar-circle" onclick="changeAvatar('üê±')">üê±</div>
            </div>
            <button class="btn-candy" onclick="closeAvatar()">Valider</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const S_URL = 'https://lcbwehiwjowgthazrydy.supabase.co';
        const S_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxjYndlaGl3am93Z3RoYXpyeWR5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkzNTg4NjIsImV4cCI6MjA4NDkzNDg2Mn0.2nP42Uh262Jt-1stolzSVM8_EEzrAdCutKgd7B2MurY';
        const client = window.supabase.createClient(S_URL, S_KEY, { auth: { persistSession: false } });

        let session = null, profile = null, currentCat = 'math', currentIdx = 0;
        const DATA = { math: [], french: [], english: [] };

        // G√©n√©ration des 60 exercices de 6√®me
        const questions = {
            math: ["12 + 8", "5 x 9", "100 - 45", "15 + 15", "6 x 7", "50 / 2", "11 x 3", "25 + 75", "9 x 4", "30 - 12", "8 x 8", "14 + 14", "60 / 3", "7 x 5", "100 / 4", "18 + 7", "9 x 9", "45 + 5", "20 x 4", "150 - 50"],
            french: ["Pluriel de 'Chat'", "F√©minin de 'Lion'", "Pluriel de 'Chou'", "Contraire de 'Grand'", "Pluriel de 'Ciel'", "Genre de 'Soleil'", "F√©minin de 'Boulanger'", "Pluriel de 'Travail'", "Synonyme de 'Heureux'", "Pluriel de 'Hibou'", "F√©minin de 'Prince'", "Pluriel de 'Feu'", "Contraire de 'Beau'", "Genre de 'Fleur'", "Pluriel de 'Journal'", "Verbe '√ätre' 1p.s", "Pluriel de 'Bal'", "F√©minin de 'Danseur'", "Pluriel de 'Caillou'", "Genre de 'Lune'"],
            english: ["'Chat' en Anglais", "'Pink' en Fran√ßais", "'Merci' en Anglais", "'Apple' en Fran√ßais", "'Chien' en Anglais", "'Blue' en Fran√ßais", "'Lundi' en Anglais", "'Hello' en Fran√ßais", "'Water' en Fran√ßais", "'P√®re' en Anglais", "'Love' en Fran√ßais", "'Goodbye' en Anglais", "'Red' en Fran√ßais", "'M√®re' en Anglais", "'Green' en Fran√ßais", "'Please' en Anglais", "'Sun' en Fran√ßais", "'One' en Fran√ßais", "'Brother' en Fran√ßais", "'Yellow' en Fran√ßais"]
        };
        const answers = {
            math: ["20", "45", "55", "30", "42", "25", "33", "100", "36", "18", "64", "28", "20", "35", "25", "25", "81", "50", "80", "100"],
            french: ["chats", "lionne", "choux", "petit", "cieux", "masculin", "boulang√®re", "travaux", "content", "hiboux", "princesse", "feux", "laid", "f√©minin", "journaux", "suis", "bals", "danseuse", "cailloux", "f√©minin"],
            english: ["cat", "rose", "thank you", "pomme", "dog", "bleu", "monday", "bonjour", "eau", "father", "amour", "au revoir", "rouge", "mother", "vert", "please", "soleil", "un", "fr√®re", "jaune"]
        };

        for(let c in questions) {
            for(let i=0; i<20; i++) { DATA[c].push({ q: questions[c][i], a: answers[c][i], id: i+1 }); }
        }

        async function handleAuth() {
            const user = document.getElementById('username').value.trim();
            const pass = document.getElementById('password').value;
            const email = user.toLowerCase() + "@candy.user";
            const { data, error } = await client.auth.signInWithPassword({ email, password: pass });
            if(error) { alert("Acc√®s refus√© !"); return; }
            session = data.user;
            loadProfile();
        }

        async function loadProfile() {
            const { data } = await client.from('profiles').select('*').eq('id', session.id).single();
            profile = data;
            document.getElementById('display-name').innerText = data.email.toUpperCase();
            document.getElementById('diamond-val').innerText = data.diamonds;
            document.getElementById('streak-val').innerText = data.streak;
            document.getElementById('auth-screen').classList.remove('active');
            document.getElementById('dashboard').classList.add('active');
            setCat('math', document.querySelector('.cat-btn'));
        }

        function setCat(cat, btn) {
            currentCat = cat; currentIdx = 0;
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const emojis = { math: 'üç©', french: 'üç¨', english: 'üç¶' };
            document.getElementById('wish-emoji').innerText = emojis[cat];
            updateCard();
        }

        function updateCard() {
            const ex = DATA[currentCat][currentIdx];
            document.getElementById('wish-title').innerText = `V≈ìu Magique #${ex.id}`;
        }

        function nav(dir) {
            currentIdx = (currentIdx + dir + 20) % 20;
            updateCard();
        }

        function openExercise() {
            const ex = DATA[currentCat][currentIdx];
            document.getElementById('ex-q').innerText = ex.q + " ?";
            document.getElementById('ex-modal').style.display = 'flex';
        }

        async function checkAns() {
            const ex = DATA[currentCat][currentIdx];
            const val = document.getElementById('ex-ans').value.trim().toLowerCase();
            if(val === ex.a.toLowerCase()) {
                confetti({ particleCount: 150, spread: 70, colors: ['#FFB3D9', '#A5E7FF'] });
                profile.diamonds += 10;
                document.getElementById('diamond-val').innerText = profile.diamonds;
                await client.from('profiles').update({ diamonds: profile.diamonds }).eq('id', session.id);
                closeModal();
                nav(1);
            } else { alert("Oups ! R√©essaie encore ‚ú®"); }
        }

        function closeModal() { document.getElementById('ex-modal').style.display = 'none'; }
        function openAvatarMenu() { document.getElementById('avatar-modal').style.display = 'flex'; }
        function closeAvatar() { document.getElementById('avatar-modal').style.display = 'none'; }
        function changeAvatar(emoji) { document.getElementById('my-avatar').innerText = emoji; }
    </script>
</body>
</html>
