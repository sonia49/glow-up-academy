<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ú® Glow Up Academy - Premium</title>
    <style>
        :root { --pink: #FF6B9D; --purple: #A29BFE; --bg: #FFF5F8; --white: #FFFFFF; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); display: flex; justify-content: center; overflow-x: hidden; }
        .screen { width: 100%; max-width: 500px; display: none; padding: 20px; box-sizing: border-box; }
        .active { display: block !important; }
        
        /* Design des Cartes */
        .card { background: var(--white); padding: 25px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; margin-bottom: 20px; }
        h1 { color: var(--pink); font-size: 1.8rem; }
        input { width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #eee; border-radius: 15px; box-sizing: border-box; font-size: 1rem; }
        
        .btn { background: var(--pink); color: white; border: none; padding: 15px 25px; width: 100%; border-radius: 50px; font-weight: bold; cursor: pointer; font-size: 1.1rem; transition: 0.3s; }
        .btn:hover { filter: brightness(1.1); }
        .btn-sub { background: var(--purple); margin-top: 10px; }

        /* Dashboard & Stats */
        .stats-bar { display: flex; justify-content: space-between; align-items: center; background: white; padding: 15px 20px; border-radius: 20px; margin-bottom: 20px; position: sticky; top: 10px; z-index: 100; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .diamond-count { color: #00CEC9; font-weight: bold; font-size: 1.2rem; }

        /* Liste des Exercices */
        .subject-tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
        .tab { padding: 8px 15px; background: white; border-radius: 15px; cursor: pointer; font-size: 0.9rem; border: 2px solid transparent; }
        .tab.active { border-color: var(--pink); color: var(--pink); font-weight: bold; }

        .exercise-card { background: white; padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: 0.2s; border-left: 5px solid var(--purple); }
        .exercise-card:hover { transform: translateX(5px); }
        .reward { color: #FF9F43; font-weight: bold; }

        /* Zone de Jeu */
        #game-zone { display: none; background: white; padding: 30px; border-radius: 25px; text-align: center; }
        .error { color: #ff4757; font-size: 0.9rem; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="auth-screen" class="screen active">
        <div class="card">
            <h1 id="auth-title">Connexion</h1>
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="pass" placeholder="Mot de passe">
            <button onclick="validerAuth()" class="btn" id="btn-text">C'est parti ! üöÄ</button>
            <p><a href="#" onclick="toggleMode()" id="switch-link" style="color: var(--pink); text-decoration:none;">Cr√©er un compte</a></p>
            <div id="auth-error" class="error"></div>
        </div>
    </div>

    <div id="dashboard-screen" class="screen">
        <div class="stats-bar">
            <span>‚ú® <b id="user-display">Joueur</b></span>
            <span class="diamond-count">üíé <span id="diamond-val">0</span></span>
            <button onclick="location.reload()" style="border:none; background:none; font-size:1.2rem; cursor:pointer;">üö™</button>
        </div>

        <div id="main-view">
            <div class="subject-tabs">
                <div class="tab active" onclick="filterEx('math')">üî¢ Maths</div>
                <div class="tab" onclick="filterEx('french')">üìö Fran√ßais</div>
                <div class="tab" onclick="filterEx('english')">üá¨üáß Anglais</div>
            </div>
            <div id="exercise-list">
                </div>
        </div>

        <div id="game-zone">
            <h2 id="ex-title">Exercice</h2>
            <p id="ex-question" style="font-size: 1.2rem; margin: 20px 0;"></p>
            <input type="text" id="ex-answer" placeholder="Ta r√©ponse ici...">
            <button onclick="verifierReponse()" class="btn">Valider ‚úÖ</button>
            <button onclick="fermerJeu()" class="btn btn-sub">Quitter</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // CONFIG SUPABASE
        const client = window.supabase.createClient(
            'https://lcbwehiwjowgthazrydy.supabase.co', 
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxjYndlaGl3am93Z3RoYXpyeWR5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkzNTg4NjIsImV4cCI6MjA4NDkzNDg2Mn0.2nP42Uh262Jt-1stolzSVM8_EEzrAdCutKgd7B2MurY',
            { auth: { persistSession: false } }
        );

        let userSession = null;
        let userDiamonds = 0;
        let currentMode = 'login';
        let currentEx = null;

        // BANQUE D'EXERCICES (Echantillon des 60 exercices)
        const EXERCISES = [
            // MATHS (Niveau 6√®me)
            { id: 1, cat: 'math', q: "15 x 4 = ?", a: "60", r: 10 },
            { id: 2, cat: 'math', q: "Combien de mm dans 1,5 cm ?", a: "15", r: 10 },
            { id: 3, cat: 'math', q: "Le p√©rim√®tre d'un carr√© de c√¥t√© 5cm ?", a: "20", r: 15 },
            { id: 4, cat: 'math', q: "123 + 87 = ?", a: "210", r: 10 },
            { id: 5, cat: 'math', q: "Moiti√© de 150 ?", a: "75", r: 10 },
            // FRAN√áAIS
            { id: 21, cat: 'french', q: "Pluriel de 'cheval' ?", a: "chevaux", r: 10 },
            { id: 22, cat: 'french', q: "F√©minin de 'directeur' ?", a: "directrice", r: 10 },
            { id: 23, cat: 'french', q: "Contraire de 'clair' ?", a: "sombre", r: 10 },
            { id: 24, cat: 'french', q: "Pass√© compos√© de 'Je (manger)' ?", a: "j'ai mang√©", r: 15 },
            // ANGLAIS
            { id: 41, cat: 'english', q: "Couleur 'Yellow' en fran√ßais ?", a: "jaune", r: 10 },
            { id: 42, cat: 'english', q: "Traduire : 'The cat is blue'", a: "le chat est bleu", r: 15 },
            { id: 43, cat: 'english', q: "Pluriel de 'Child' ?", a: "children", r: 20 },
            { id: 44, cat: 'english', q: "Comment dit-on 'Bonjour' le matin ?", a: "good morning", r: 10 }
            // ... (On peut en ajouter jusqu'√† 60 facilement ici)
        ];

        // --- AUTHENTIFICATION ---
        function toggleMode() {
            currentMode = (currentMode === 'login') ? 'signup' : 'login';
            document.getElementById('auth-title').innerText = currentMode === 'login' ? "Connexion" : "Inscription";
            document.getElementById('btn-text').innerText = currentMode === 'login' ? "C'est parti ! üöÄ" : "Cr√©er mon compte ‚ú®";
        }

        async function validerAuth() {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('pass').value;
            const errBox = document.getElementById('auth-error');
            errBox.innerText = "Chargement...";

            try {
                let res;
                if(currentMode === 'signup') {
                    res = await client.auth.signUp({ email, password });
                    if(res.error) throw res.error;
                    // Cr√©ation du profil initial dans la table SQL
                    await client.from('profiles').insert([{ id: res.data.user.id, email: email, diamonds: 0 }]);
                    alert("Compte cr√©√© ! Connecte-toi.");
                    location.reload();
                } else {
                    res = await client.auth.signInWithPassword({ email, password });
                    if(res.error) throw res.error;
                    userSession = res.data.user;
                    chargerProfil();
                }
            } catch (e) { errBox.innerText = "‚ùå " + e.message; }
        }

        // --- DONN√âES UTILISATEUR ---
        async function chargerProfil() {
            const { data, error } = await client.from('profiles').select('*').eq('id', userSession.id).single();
            if(!error && data) {
                userDiamonds = data.diamonds;
                document.getElementById('diamond-val').innerText = userDiamonds;
                document.getElementById('user-display').innerText = data.email.split('@')[0];
            }
            document.getElementById('auth-screen').classList.remove('active');
            document.getElementById('dashboard-screen').classList.add('active');
            filterEx('math');
        }

        async function saveDiamonds(nouveauMontant) {
            userDiamonds += nouveauMontant;
            document.getElementById('diamond-val').innerText = userDiamonds;
            await client.from('profiles').update({ diamonds: userDiamonds }).eq('id', userSession.id);
        }

        // --- GESTION EXERCICES ---
        function filterEx(category) {
            const list = document.getElementById('exercise-list');
            list.innerHTML = "";
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            const filtered = EXERCISES.filter(e => e.cat === category);
            filtered.forEach(ex => {
                const div = document.createElement('div');
                div.className = "exercise-card";
                div.innerHTML = `<span>Exercice #${ex.id}</span> <span class="reward">+${ex.r} üíé</span>`;
                div.onclick = () => ouvrirJeu(ex);
                list.appendChild(div);
            });
        }

        function ouvrirJeu(ex) {
            currentEx = ex;
            document.getElementById('main-view').style.display = 'none';
            document.getElementById('game-zone').style.display = 'block';
            document.getElementById('ex-title').innerText = "Mission " + ex.cat.toUpperCase();
            document.getElementById('ex-question').innerText = ex.q;
            document.getElementById('ex-answer').value = "";
        }

        function verifierReponse() {
            const rep = document.getElementById('ex-answer').value.trim().toLowerCase();
            if(rep === currentEx.a.toLowerCase()) {
                alert("üéâ BRAVO ! Tu gagnes " + currentEx.r + " diamants !");
                saveDiamonds(currentEx.r);
                fermerJeu();
            } else {
                alert("‚ùå Oups, r√©essaie encore !");
            }
        }

        function fermerJeu() {
            document.getElementById('main-view').style.display = 'block';
            document.getElementById('game-zone').style.display = 'none';
        }
    </script>
</body>
</html>
